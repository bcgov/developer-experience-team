# Checking IDIR (Entra ID) Status of Linked GitHub Users

This folder contains a set of scripts for cross-referencing GitHub IDs within an organization and linked Entra ID users. The purpose is to identify users who are active GitHub organization members and were Entra ID tenant members at one point, but may not be current members. For example, their Entra ID account has expired and/or they are no longer employees of the organization's whose tenant hosts the Entra ID directory that they linked against. 

## Prerequisites

- A MacOS or Linux system with `zsh` (tested only on MacOS).
- A python 3+ environment
- `gh` command line tool
- An Entra ID within the target Azure tenancy
- A GitHub ID with owner permissions on the organization you're checking users against

## How to use

A single script can be used to generate a list of email addresses for GitHub users who have linked an SSO identity. The steps below decribe the pre-requisites/setup for running the script.

### Set up

- create and activate a python [virtual environment](https://docs.python.org/3/library/venv.html) (recommended)
```shell
python -m venv /path/to/new/virtual/environment
```
- install python dependencies
```shell
pip install -r requirements.txt
```
- authenticate with `gh` client
```shell
gh login auth
```

Once you've completed the steps above, you're ready to run the main script.

### Running the main script `check_users.sh`

`check_users.sh` is a shell script that makes use of the `gh` command line tool as well as `jq`, python, and general command line functionality. 

Running the script is done as shown below.

```shell
./check_users.sh
```

When the script runs, you'll be prompted in a web browser to login into Entra ID with a screen similar to the one below. This is required in order to call the Microsoft Graph API to retrieve details about Entra ID users. This prompt will show each time the script is run.

![Azure Login](azure_login.png)

The script takes a few moments to run and may not show any output, but give it some time, as it will only show emails addresses that match the filters in the script (linked GitHub IDs, with no active corresponding Entra ID record), and there may not be many users that match these. 

Output is in the form shown below (sample data generated by [GenerateData.com](https://generatedata.com/generator) ), and can easily be process further as CSV data if needed.

```text
commodo.tincidunt.nibh@gmail.com
non.sapien@hotmail.org
cursus.a.enim@icloud.org
est.tempor@outlook.net
magna.nec@icloud.org
```

#### Notes

1. Information abbout users' SSO identitites is not readily available via the GitHub REST API, but it is available using the GitHub graphQL API. This, and the fact that it was slightly easier to call the graphQL API from `gh` than python is the reason that both are used, vs. having all data retrieval happen within the python script. This could be revisited at some point to simplify things.

2. If other data elements besides the SSO-associated email address are needed, the scripts could easily be modified accordingly, or copied and adapted for other purposes without much effort. 




